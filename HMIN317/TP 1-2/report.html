<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>HMIN 317 - Moteurs de Jeux : Prise en main de Qt Creator, Git et OpenGL ES 3.0</title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-light">
        <h1 id="hmin-317---moteurs-de-jeux--prise-en-main-de-qt-creator-git-et-opengl-es-30">HMIN 317 - Moteurs de Jeux : Prise en main de Qt Creator, Git et OpenGL ES 3.0</h1>
<h2 id="transformations">Transformations</h2>
<p>Un <code>Objet 3D</code> doit pourvoir subir diff√©rentes op√©rations math√©matiques pour pouvoir le positionner et orienter dans l'espace.
Pour se faire, on utilise les <strong>matrices de transformations</strong>.</p>
<p>Les trois transformations n√©cessaires pour repr√©senter un objet sont :</p>
<ul>
<li>Les translations <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span></span></span></span></li>
<li>Les rotations <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span></li>
<li>Les homoth√©ties <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span></li>
</ul>
<p>La multiplication de matrices est l'√©quvalent de la composition des transformations, nous pouvons donc d√©finir une matrice repr√©sentant la transformation de notre objet (Model Matrix <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span>).</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mi>T</mi><mo>√ó</mo><mi>R</mi><mo>√ó</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">M = T \times R \times S
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span></span></p>
<p>Pour simplifier les usages, nous ne travaillons pas directement avec des matrices, mais avec des objets plus simples repr√©sentant ces transformations qui seront convertis en matrices.</p>
<p>Sous Qt, nous avons les √©l√©ments suivants :</p>
<ul>
<li>Les matrices sont repr√©sent√©es par des <code>QMatrix4x4</code></li>
<li>Les translations et homoth√©ties sont repr√©sent√©e par des <code>QVector3D</code></li>
<li>Les rotations sont repr√©sent√©es par des <code>QQuaternion</code></li>
</ul>
<p>On peut donc par exemple, appliquer une transformation √† notre objet</p>
<pre><code class="language-C++"><div>QMatrix4x4 transform;
QVector3 translation = QVector3(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">-5.0</span>);
<span class="hljs-comment">// Rotation of 45¬∞ around Y</span>
QQuaternion rotation = QQuaternion::fromAxisAndAngle(QVector3(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">45.0</span>);
QVector3 scale = QVector3(<span class="hljs-number">2.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>);

transform.translate(translation);
transform.rotate(rotation);
transform.scale(scale);
</div></code></pre>
<p><em>Pour la 2D, il existe l'√©quivalent <a href="https://doc.qt.io/qt-5/qtransform.html#details"><code>QTransform</code> üîó</a></em></p>
<h2 id="dessin-en-3d">Dessin en 3D</h2>
<p>Pour dessiner des objets sur l'√©cran, on utilise ici une surcouche d'<strong>OpenGL</strong>.
On cr√©e des <code>QOpenGLBuffer</code> pour d√©finir nos VBOs.</p>
<p>Notre code de rendu ira dans la m√©thode <code>paintGL</code> de la classe <code>MainWidget</code>.</p>
<p>‚û°Ô∏è<a href="https://doc.qt.io/qt-5.9/qopenglwidget.html">QOpenGLWidget Documentation üîó</a></p>
<h2 id="gestion-des-inputs">Gestion des Inputs</h2>
<p>Pour g√©rer les entr√©es utilisateurs, on utilise les callbacks fournis par la classe <code>QWidget</code>.</p>
<p>‚û°Ô∏è<a href="https://doc.qt.io/qt-5/qwidget.html#protected-functions">QWidget Event Callbacks üîó</a></p>
<h2 id="g√©n√©ration-de-terrain-avec-une-heightmap">G√©n√©ration de terrain avec une Heightmap</h2>
<h3 id="g√©n√©ration-dun-plan-subdivis√©">G√©n√©ration d'un plan subdivis√©</h3>
<p>La premi√®re √©tape consiste √† g√©n√©rer un plan subdivis√© sur lequel nous allons ensuite modifier la hauteur des sommets.</p>
<p>Pour se faire, nous utilisons un <a href="https://en.wikipedia.org/wiki/Triangle_strip">Triangle Strip üîó</a>.</p>
<p><em>Une autre m√©thode est d'utiliser des √©l√©ments, mais moins optimal.   <a href="https://github.com/Eikins/3D-Sea-Project/blob/master/sea3d/core/mesh.py#L118"><code>Mesh.Plane</code> üîó</a></em></p>
<h4 id="impl√©mentation">Impl√©mentation</h4>
<p>‚û°Ô∏è <a href="https://github.com/Eikins/M2-Imagina/blob/master/HMIN317/TP%201-2/QtProject/geometryengine.cpp#L83">geometryengine.cpp::generatePlaneGeometryüîó</a></p>
<p>On modifie la hauteur des vertices au runtime.
On applique ensuite une texture en fonction de la hauteur.<br>
On travaille toujours dans l'<em>Object Space</em> pour rester ind√©pendant des transformations appliqu√©es au terrain.</p>
<h4 id="terrain_vertexglsl">terrain_vertex.glsl</h4>
<pre><code class="language-GLSL"><div><span class="hljs-type">void</span> main()
{
    v_texCoord0 = texCoord0;

    <span class="hljs-type">vec4</span> pos = <span class="hljs-type">vec4</span>(position, <span class="hljs-number">1.0</span>);
    <span class="hljs-comment">// Terrain height displacement</span>
    pos.y += <span class="hljs-built_in">texture2D</span>(_HeightMap, texCoord0).r * MAX_HEIGHT;
    v_osPos = pos.xyz;

    <span class="hljs-built_in">gl_Position</span> = ObjectToClip(pos);
}
</div></code></pre>
<h4 id="terrain_fragmentglsl">terrain_fragment.glsl</h4>
<pre><code class="language-GLSL"><div><span class="hljs-type">void</span> main()
{
    <span class="hljs-type">vec3</span> color;
    <span class="hljs-type">vec3</span> rockColor = <span class="hljs-built_in">texture2D</span>(_RockTexMap, v_texCoord0 * <span class="hljs-number">10</span>).xyz;
    <span class="hljs-keyword">if</span> (v_osPos.y &gt; ROCK_HEIGHT)
    {
        <span class="hljs-type">vec3</span> snowrockColor = <span class="hljs-built_in">texture2D</span>(_SnowrockTexMap, v_texCoord0 * <span class="hljs-number">10</span>).xyz;
        color = <span class="hljs-built_in">mix</span>(rockColor, snowrockColor, (v_osPos.y - ROCK_HEIGHT) / (SNOW_HEIGHT - ROCK_HEIGHT));
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-type">vec3</span> grassColor = <span class="hljs-built_in">texture2D</span>(_GrassTexMap, v_texCoord0 * <span class="hljs-number">10</span>).xyz;
        color = <span class="hljs-built_in">mix</span>(grassColor, rockColor, (v_osPos.y - GRASS_HEIGHT) / (ROCK_HEIGHT - GRASS_HEIGHT));
    }

    <span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color, <span class="hljs-number">1.0</span>);
}
</div></code></pre>
<h4 id="r√©sultat">R√©sultat</h4>
<img src="img\terrain.png" width="600">
<h2 id="gestion-de-la-cam√©ra">Gestion de la Cam√©ra</h2>
<p>Pour calculer les coordonn√©es dans le <em>Clip Space</em> des objets, on utilises deux matrices d√©finis par notre cam√©ra.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>V</mi><mi>P</mi><mo>=</mo><mi>P</mi><mo>√ó</mo><mi>V</mi><mo>√ó</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">MVP = P \times V \times M
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span></span></p>
<table>
<thead>
<tr>
<th>Matrice</th>
<th>Nom</th>
<th>Transformation</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span></td>
<td>Model</td>
<td><em>Object Space</em> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚Üí</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">‚Üí</span></span></span></span> <em>World Space</em></td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span></span></span></span></td>
<td>Vue</td>
<td><em>World Space</em> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚Üí</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">‚Üí</span></span></span></span> <em>View Space</em></td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span></td>
<td>Projection</td>
<td><em>View Space</em> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚Üí</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">‚Üí</span></span></span></span> <em>Clip Space</em></td>
</tr>
</tbody>
</table>
<p><em>Note: Si on souhaite d√©finir la cam√©ra comme un objet de la sc√®ne, on a alors la propri√©t√©: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>=</mo><msubsup><mi>M</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow><mrow><mo>‚àí</mo><mn>1</mn></mrow></msubsup></mrow><annotation encoding="application/x-tex">V_{Cam} = M_{Cam}^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.14777em;vertical-align:-0.293531em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.854239em;"><span style="top:-2.4064690000000004em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span><span style="top:-3.1031310000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚àí</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.293531em;"><span></span></span></span></span></span></span></span></span></span>.<br>
On ajoutera aussi que d√©finir une homoth√©tie pour une cam√©ra n'a pas de sens,
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>=</mo><msub><mi>T</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>√ó</mo><msub><mi>R</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{Cam} = T_{Cam} \times R_{Cam}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. Ce qui nous donne facilement <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">V_{Cam}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</em></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>R</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo>√ó</mo><mo stretchy="false">(</mo><msub><mi>T</mi><mrow><mi>C</mi><mi>a</mi><mi>m</mi></mrow></msub><msup><mo stretchy="false">)</mo><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">V_{Cam} = (R_{Cam})^T \times (T_{Cam})^{-1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">m</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚àí</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h3 id="d√©placement-de-la-cam√©ra-√†-hauteur-du-terrain">D√©placement de la cam√©ra √† hauteur du terrain</h3>
<p>Pour se faire, il suffit de r√©cup√©rer la position de la cam√©ra dans l'<em>Object Space</em> du terrain et de sampler la hauteur de celle ci. Cette op√©ration peut se faire au vertex shader, tout comme du c√¥t√© du CPU.</p>
<p>Ici, on simplifie car on sait que notre terrain n'a aucune transformation, on utilise donc directement la position <em>World Space</em> de la cam√©ra.</p>
<h4 id="terrain_vertexglsl-1">terrain_vertex.glsl</h4>
<pre><code class="language-GLSL"><div><span class="hljs-type">void</span> main()
{
    v_texCoord0 = texCoord0;

    <span class="hljs-type">vec4</span> pos = <span class="hljs-type">vec4</span>(position, <span class="hljs-number">1.0</span>);
    <span class="hljs-comment">// Terrain height</span>
    pos.y += <span class="hljs-built_in">texture2D</span>(_HeightMap, texCoord0).r * MAX_HEIGHT;
    v_osPos = pos.xyz;

    <span class="hljs-comment">// If we want to support terrain transforms, then we need</span>
    <span class="hljs-comment">// the inverse model (mat_ObjectToWorld_I) of the terrain</span>
    <span class="hljs-comment">// and then transform the cam_Position</span>
    <span class="hljs-type">float</span> camHeight = <span class="hljs-built_in">texture2D</span>(_HeightMap, cam_Position.xz).r * MAX_HEIGHT;
    pos.y -= camHeight;

    <span class="hljs-built_in">gl_Position</span> = ObjectToClip(pos);
}
</div></code></pre>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="img\terrain_cam_0.png" width="200"></td>
<td><img src="img\terrain_cam_1.png" width="200"></td>
<td><img src="img\terrain_cam_2.png" width="200"></td>
</tr>
</tbody>
</table>
<h3 id="cam√©ra-rotative">Cam√©ra rotative</h3>
<p>On peut faire tourner la cam√©ra autour du point <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span></span></span></span> avec un angle de 45¬∞.</p>
<img src="img\cam_rotate.png" width="300">
<p>Pour se faire, on d√©finit une distance <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span></span></span></span> au centre.
On d√©finit une vitesse <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> en unit√© par seconde.</p>
<p>On obtient ais√©ment:<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mfrac><mi>D</mi><msqrt><mn>2</mn></msqrt></mfrac></mrow><annotation encoding="application/x-tex">d = \frac{D}{\sqrt{2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4103309999999998em;vertical-align:-0.5379999999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.5510085em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.912845em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.872845em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.12715500000000002em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5379999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>,
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œâ</mi><mo>=</mo><mfrac><mrow><mi>d</mi><mi>Œ∏</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mi>v</mi><mi>d</mi></mfrac></mrow><annotation encoding="application/x-tex">\omega = \frac{d\theta}{dt} = \frac{v}{d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">œâ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">Œ∏</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.040392em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mi>d</mi><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false">(</mo><mi>Œ∏</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x = d \cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">Œ∏</span><span class="mclose">)</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">y = d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span><br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mi>d</mi><mi>sin</mi><mo>‚Å°</mo><mo stretchy="false">(</mo><mi>Œ∏</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">z = d \sin(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">Œ∏</span><span class="mclose">)</span></span></span></span></p>
<p>Pour l'orientation, on utilise simplement la m√©thode <code>lookAt</code>.</p>
<pre><code class="language-C++"><div>    _cameraAngle += _cameraSpeed * <span class="hljs-number">0.016</span> / _cameraDistance;
    <span class="hljs-keyword">if</span> (_cameraAngle &gt; TAU) _cameraAngle -= TAU;
    <span class="hljs-function">QVector3D <span class="hljs-title">camPos</span><span class="hljs-params">(
        _cameraDistance * <span class="hljs-built_in">cos</span>(_cameraAngle),
        _cameraDistance,
        _cameraDistance * <span class="hljs-built_in">sin</span>(_cameraAngle)
    )</span></span>;

    <span class="hljs-function">QVector3D <span class="hljs-title">camUp</span><span class="hljs-params">(camPos)</span></span>;
    camUp.setX(-camUp.x());
    camUp.setZ(-camUp.z());

    <span class="hljs-comment">// LookAt method directly gives inverted matrix</span>
    <span class="hljs-comment">// This is not optimal because we work with the camera</span>
    <span class="hljs-comment">// model and we need to invert it again.</span>
    <span class="hljs-comment">// But we don't care about perfs for now.</span>
    QMatrix4x4 lookAtMat;
    lookAtMat.lookAt(camPos, QVector3D(<span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>, <span class="hljs-number">0.0F</span>), camUp);
    view = lookAtMat.inverted();

    update();
</div></code></pre>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="img\lookat_0.png" width="200"></td>
<td><img src="img\lookat_1.png" width="200"></td>
</tr>
</tbody>
</table>
<h2 id="taux-de-rafra√Æchissements">Taux de rafra√Æchissements</h2>
<p>Jusqu'√† maintenant, on d√©finissait la vitesse ind√©pendant du framerate et tu temps √©coul√© entre deux frames.</p>
<p>Cela veut donc dire que notre jeux serait ralentit si le framerate est bas.<br>
C'est ce que l'on observe si on compare 4 fen√™tres avec des fr√©quences diff√©rentes.</p>
<p>Certains jeux de combats restent frame-dependent, car on essaye de donner au joueur un feedback constant par rapport √† ses inputs et ce qu'il observe, mais ce n'est pas convenable pour la plupart des jeux.</p>
<p>La solution d'utiliser la <a href="https://fr.wikipedia.org/wiki/M%C3%A9thode_des_diff%C3%A9rences_finies">M√©thode des diff√©rences finies üîó</a>.<br>
On √©chantillone notre espace de temps en calculant le temps √©coul√© entre deux frames, souvent d√©nom√© <code>deltaTime</code>.<br>
Gr√¢ce √† √ßa, on peut r√©soudre les √©quations de d√©placements de notre cam√©ra correctement.</p>
<p><em>Note: Contrairement √† une simulation, on est oblig√© d'utiliser un sch√©ma explicite (qui utilise des valeurs de temps pass√©es uniquement), cela qui un probl√®me au niveau de la convergence de la solution, mais ce n'est pas un probl√®me pour les jeux.<br>
C'est d'ailleurs aussi la discretisation qui cr√©e les bugs de non d√©tection de collisions lorsque la vitesse des objets est trop √©lev√©es.</em></p>

    </body>
    </html>